import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as c}from"./index.DFATbet1.js";import{u as k,G as C}from"./GastosContext.ChU6grDc.js";import{u as N}from"./useCurrency.CU1OSAUD.js";import{A as M,m as i}from"./proxy.B2mgxuCV.js";import{s as P}from"./supabase.D8XsvUjI.js";import"./_commonjsHelpers.D6-XlEtG.js";import"./LoadingSpinner.CRtF3Vaf.js";const G=({isOpen:l,onClose:r,gastos:x,personas:h})=>{const{formatCurrency:d}=N();return l?e.jsx(M,{children:l&&e.jsx(i.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx(i.div,{initial:{opacity:0},animate:{opacity:.75},exit:{opacity:0},className:"fixed inset-0 transition-opacity","aria-hidden":"true",onClick:r,children:e.jsx("div",{className:"absolute inset-0 bg-gray-900"})}),e.jsx(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.3},className:"inline-block align-bottom bg-white rounded-2xl text-left overflow-hidden shadow-2xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full",children:e.jsxs("div",{className:"bg-white px-6 pt-6 pb-4 sm:p-6 sm:pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-indigo-100 to-purple-100 rounded-full flex items-center justify-center mr-3 shadow-inner",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-indigo-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),"Detalles de Gastos Compartidos"]}),e.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-500 transition-colors",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"space-y-4",children:x.map((a,g)=>{const m=a.porcentajepersona1||0,p=a.porcentajepersona2||0,u=h.find(o=>o.id===a.personaid);return h.find(o=>o.email===a.otraPersonaEmail),e.jsxs(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:g*.1},className:"bg-gradient-to-r from-gray-50 to-gray-100 rounded-xl p-6 hover:shadow-md transition-all duration-300 border border-gray-100",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-indigo-600",children:d(a.monto)}),e.jsx("div",{className:"text-lg text-gray-700 mt-1",children:a.descripcion}),e.jsx("div",{className:"text-sm text-gray-500 mt-2",children:new Date(a.fecha).toLocaleDateString("es-ES",{day:"numeric",month:"long",year:"numeric"})})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(i.div,{whileHover:{scale:1.02},className:"flex items-center justify-between p-4 bg-white rounded-lg shadow-sm hover:shadow-md transition-all duration-300 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-indigo-100 to-purple-100 rounded-full flex items-center justify-center mr-3 shadow-inner",children:e.jsx("span",{className:"text-indigo-600 font-semibold",children:u?.email?.charAt(0)})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:u?.email}),e.jsxs("div",{className:"text-xs text-indigo-500 font-medium",children:[m,"% del total"]})]})]}),e.jsx("div",{className:"text-lg font-bold text-gray-900",children:d(a.monto*m/100)})]}),e.jsxs(i.div,{whileHover:{scale:1.02},className:"flex items-center justify-between p-4 bg-white rounded-lg shadow-sm hover:shadow-md transition-all duration-300 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-indigo-100 to-purple-100 rounded-full flex items-center justify-center mr-3 shadow-inner",children:e.jsx("span",{className:"text-indigo-600 font-semibold",children:a.otraPersonaEmail?.charAt(0)})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:a.otraPersonaEmail}),e.jsxs("div",{className:"text-xs text-indigo-500 font-medium",children:[p,"% del total"]})]})]}),e.jsx("div",{className:"text-lg font-bold text-gray-900",children:d(a.monto*p/100)})]})]})]},a.id)})})]})})]})})}):null},L=()=>{const{gastos:l,personas:r,recargarDatos:x}=k(),{formatCurrency:h}=N(),[d,a]=c.useState([]),[g,m]=c.useState(!1),[p,u]=c.useState("");c.useEffect(()=>{const t=()=>{x()};return window.addEventListener("actualizarGastos",t),()=>{window.removeEventListener("actualizarGastos",t)}},[x]),c.useEffect(()=>{console.log("Personas:",r),console.log("Gastos:",l)},[r,l]),c.useEffect(()=>{P.auth.getUser().then(({data:{user:t}})=>{u(t?.email??"")})},[]);const o=l.filter(t=>t.escompartido),w=(()=>{const t={};return r.forEach(s=>{t[s.id]={total:0,email:s.email,percentage:0,otherPersonEmail:""}}),o.forEach(s=>{const n=s.personaid,j=s.otraPersonaEmail;if(n&&s.porcentajepersona1){const y=s.monto*s.porcentajepersona1/100;t[n].total+=y,t[n].percentage=s.porcentajepersona1,t[n].otherPersonEmail=j??""}if(j&&s.porcentajepersona2){const y=s.monto*s.porcentajepersona2/100,f=r.find(v=>v.email===j)?.id;f&&(t[f].total+=y,t[f].percentage=s.porcentajepersona2,t[f].otherPersonEmail=r.find(v=>v.id===n)?.email??"")}}),t})(),E=()=>{a(o),m(!0)},b=r.filter(t=>w[t.id]?.total>0);return o.length===0||b.length===0?e.jsx(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"bg-white rounded-2xl shadow-lg p-8 flex justify-center items-center",children:e.jsxs("div",{className:"flex flex-col items-center justify-center text-center py-12",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-indigo-100 to-purple-100 rounded-full flex items-center justify-center mb-6 shadow-inner",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-indigo-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-3",children:"No has compartido gastos"}),e.jsx("p",{className:"text-gray-500 max-w-md text-lg leading-relaxed",children:"Cuando compartas gastos con otra persona, aparecerán aquí para que puedas ver el desglose de los gastos compartidos."})]})}):e.jsxs(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"bg-white rounded-2xl shadow-lg p-8 mb-8",children:[e.jsx("div",{className:"flex items-center justify-between mb-8",children:e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-indigo-100 to-purple-100 rounded-full flex items-center justify-center mr-3 shadow-inner",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-indigo-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})})}),"Gastos Compartidos"]})}),e.jsx("div",{className:"space-y-4",children:b.map(t=>{const s=w[t.id],n=t.email===p;return e.jsxs(i.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3},whileHover:{scale:1.02},className:"flex items-center justify-between p-6 bg-gradient-to-r from-gray-50 to-gray-100 rounded-xl hover:shadow-md transition-all duration-300 border border-gray-100",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-indigo-100 to-purple-100 rounded-full flex items-center justify-center mr-3 shadow-inner",children:e.jsx("span",{className:"text-indigo-600 font-semibold",children:t.nombre.charAt(0)})}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[t.nombre,n&&e.jsx("span",{className:"ml-3 px-3 py-1 text-xs font-medium bg-gradient-to-r from-indigo-100 to-purple-100 text-indigo-800 rounded-full shadow-sm",children:"Tú"})]}),e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:["Compartido con ",s?.otherPersonEmail]})]})]})}),e.jsxs(i.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:E,className:"bg-white p-5 rounded-xl shadow-sm hover:shadow-lg transition-all duration-300 cursor-pointer border border-gray-200 hover:border-indigo-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-indigo-600 font-medium",children:"Compartido"}),e.jsx("span",{className:"font-bold text-gray-900 text-lg",children:h(s?.total||0)})]}),e.jsxs("div",{className:"text-sm text-indigo-500 font-medium",children:[s?.percentage||0,"% del total"]})]})]},t.id)})}),d.length>0&&e.jsx(G,{isOpen:g,onClose:()=>{m(!1),a([])},gastos:d,personas:r})]})},I=()=>e.jsx(C,{children:e.jsx(L,{})});export{I as default};
