import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as s}from"./index.BVOCwoKb.js";import{s as w}from"./supabase.4P1wv7wr.js";import j from"./LoadingSpinner.D7PxHcXC.js";import{B as y}from"./constants.CU4QNKZE.js";function v(){const[t,d]=s.useState(""),[n,m]=s.useState(""),[c,l]=s.useState(!1),[u,o]=s.useState(null),[h,x]=s.useState(!1),[b,i]=s.useState(!1),f=async r=>{r.preventDefault(),o(null),l(!0);try{const{error:a}=await w.auth.signInWithPassword({email:t,password:n});a?(a.message.includes("Email not confirmed")?o("Necesitas confirmar tu email antes de iniciar sesión. Por favor revisa tu bandeja de entrada."):o(a.message),l(!1)):window.location.href=`${y}/`}catch(a){o(a.message),l(!1)}},p=async()=>{x(!0),i(!1);try{const{error:r}=await w.auth.resend({type:"signup",email:t});r?o(`Error al reenviar correo: ${r.message}`):(i(!0),o(null))}catch(r){o("No se pudo reenviar el correo de confirmación"),console.error(r)}finally{x(!1)}};return e.jsx("div",{className:"w-full max-w-md mx-auto",children:e.jsxs("form",{onSubmit:f,className:"bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6 text-center",children:"Iniciar sesión"}),u&&e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert",children:[e.jsx("span",{className:"block sm:inline",children:u}),u.includes("confirmar tu email")&&e.jsx("button",{type:"button",onClick:p,disabled:h,className:"mt-2 text-blue-700 underline hover:text-blue-900 disabled:opacity-50",children:h?"Enviando...":"Reenviar correo de confirmación"})]}),b&&e.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4",role:"alert",children:e.jsx("span",{className:"block sm:inline",children:"Se ha enviado un nuevo correo de confirmación. Por favor verifica tu bandeja de entrada."})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"email",children:"Email"}),e.jsx("input",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:"email",type:"email",placeholder:"Email",value:t,onChange:r=>d(r.target.value),required:!0})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"password",children:"Contraseña"}),e.jsx("input",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline",id:"password",type:"password",placeholder:"Contraseña",value:n,onChange:r=>m(r.target.value),required:!0})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("button",{className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline w-full",type:"submit",disabled:c,children:c?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(j,{size:"small",color:"white"}),e.jsx("span",{className:"ml-2",children:"Cargando..."})]}):"Iniciar sesión"})})]})})}function N(){const[t,d]=s.useState(""),[n,m]=s.useState(""),[c,l]=s.useState(""),[u,o]=s.useState(""),[h,x]=s.useState(!1),[b,i]=s.useState(null),[f,p]=s.useState(null),r=async a=>{if(a.preventDefault(),i(null),p(null),n!==c){i("Las contraseñas no coinciden");return}if(n.length<6){i("La contraseña debe tener al menos 6 caracteres");return}x(!0);try{const{error:g}=await w.auth.signUp({email:t,password:n,options:{data:{nombre:u}}});if(g)throw g;p("Te hemos enviado un correo de confirmación. Por favor, revisa tu bandeja de entrada.")}catch(g){i(g.message)}finally{x(!1)}};return e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-md",children:[b&&e.jsx("div",{className:"mb-4 p-4 text-red-700 bg-red-100 rounded-md",children:b}),f&&e.jsx("div",{className:"mb-4 p-4 text-green-700 bg-green-100 rounded-md",children:f}),e.jsxs("form",{onSubmit:r,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"nombre",children:"Nombre"}),e.jsx("input",{id:"nombre",type:"text",value:u,onChange:a=>o(a.target.value),required:!0,className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",placeholder:"Tu nombre"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"email",children:"Email"}),e.jsx("input",{id:"email",type:"email",value:t,onChange:a=>d(a.target.value),required:!0,className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",placeholder:"tu@email.com"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"password",children:"Contraseña"}),e.jsx("input",{id:"password",type:"password",value:n,onChange:a=>m(a.target.value),required:!0,className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",placeholder:"********"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"confirmPassword",children:"Confirmar Contraseña"}),e.jsx("input",{id:"confirmPassword",type:"password",value:c,onChange:a=>l(a.target.value),required:!0,className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",placeholder:"********"})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("button",{type:"submit",disabled:h,className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline w-full disabled:opacity-50 flex items-center justify-center",children:h?e.jsxs(e.Fragment,{children:[e.jsx(j,{size:"small",color:"white",className:"mr-2"}),e.jsx("span",{children:"Procesando registro..."})]}):"Registrarse"})})]})]})}function L(){const[t,d]=s.useState(!0),[n,m]=s.useState(!0);return s.useEffect(()=>{(async()=>{const{data:{session:l}}=await w.auth.getSession();l&&(window.location.href=`${y}/`),m(!1)})()},[]),n?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(j,{size:"large",color:"primary"})}):e.jsxs("div",{className:"p-6 max-w-md mx-auto",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsxs("div",{className:"inline-flex bg-gray-200 rounded-lg p-1",children:[e.jsx("button",{className:`py-2 px-4 rounded-md ${t?"bg-white shadow-sm":"text-gray-700 hover:bg-gray-300"}`,onClick:()=>d(!0),children:"Iniciar sesión"}),e.jsx("button",{className:`py-2 px-4 rounded-md ${t?"text-gray-700 hover:bg-gray-300":"bg-white shadow-sm"}`,onClick:()=>d(!1),children:"Registrarse"})]})}),t?e.jsx(v,{}):e.jsx(N,{})]})}export{L as default};
