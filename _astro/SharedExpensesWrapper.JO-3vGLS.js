import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as i}from"./index.DFATbet1.js";import{u as E,G as C}from"./GastosContext.ChU6grDc.js";import{u as N}from"./useCurrency.B05I4NJU.js";import{s as G}from"./supabase.D8XsvUjI.js";import"./_commonjsHelpers.D6-XlEtG.js";import"./LoadingSpinner.CRtF3Vaf.js";const P=({isOpen:l,onClose:r,gastos:m,personas:x})=>{const{formatCurrency:n}=N();return l?e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 transition-opacity","aria-hidden":"true",children:e.jsx("div",{className:"absolute inset-0 bg-gray-500 opacity-75"})}),e.jsxs("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full",children:[e.jsx("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:e.jsx("div",{className:"sm:flex sm:items-start",children:e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:text-left w-full",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900 mb-4",children:"Detalles de Gastos Compartidos"}),e.jsx("div",{className:"space-y-4",children:m.map(a=>{const h=a.porcentajepersona1||0,d=a.porcentajepersona2||0,u=x.find(c=>c.id===a.personaid);return x.find(c=>c.email===a.otraPersonaEmail),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-colors",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold text-indigo-600",children:n(a.monto)}),e.jsx("div",{className:"text-sm text-gray-500",children:a.descripcion}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:new Date(a.fecha).toLocaleDateString("es-ES",{day:"numeric",month:"long",year:"numeric"})})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white border border-gray-200 rounded-lg hover:border-indigo-300 transition-colors",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:u?.email}),e.jsxs("div",{className:"text-xs text-gray-500",children:[h,"% del total"]})]}),e.jsx("div",{className:"text-sm font-medium text-gray-900",children:n(a.monto*h/100)})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white border border-gray-200 rounded-lg hover:border-indigo-300 transition-colors",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:a.otraPersonaEmail}),e.jsxs("div",{className:"text-xs text-gray-500",children:[d,"% del total"]})]}),e.jsx("div",{className:"text-sm font-medium text-gray-900",children:n(a.monto*d/100)})]})]})]},a.id)})})]})})}),e.jsx("div",{className:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:e.jsx("button",{type:"button",className:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",onClick:r,children:"Cerrar"})})]})]})}):null},S=()=>{const{gastos:l,personas:r,recargarDatos:m}=E(),{formatCurrency:x}=N(),[n,a]=i.useState([]),[h,d]=i.useState(!1),[u,c]=i.useState("");i.useEffect(()=>{const s=()=>{m()};return window.addEventListener("actualizarGastos",s),()=>{window.removeEventListener("actualizarGastos",s)}},[m]),i.useEffect(()=>{console.log("Personas:",r),console.log("Gastos:",l)},[r,l]),i.useEffect(()=>{G.auth.getUser().then(({data:{user:s}})=>{c(s?.email??"")})},[]);const f=l.filter(s=>s.escompartido),y=(()=>{const s={};return r.forEach(t=>{s[t.id]={total:0,email:t.email,percentage:0,otherPersonEmail:""}}),f.forEach(t=>{const o=t.personaid,g=t.otraPersonaEmail;if(o&&t.porcentajepersona1){const j=t.monto*t.porcentajepersona1/100;s[o].total+=j,s[o].percentage=t.porcentajepersona1,s[o].otherPersonEmail=g??""}if(g&&t.porcentajepersona2){const j=t.monto*t.porcentajepersona2/100,p=r.find(b=>b.email===g)?.id;p&&(s[p].total+=j,s[p].percentage=t.porcentajepersona2,s[p].otherPersonEmail=r.find(b=>b.id===o)?.email??"")}}),s})(),w=()=>{a(f),d(!0)},v=r.filter(s=>y[s.id]?.total>0);return f.length===0||v.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-8",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Gastos Compartidos"}),e.jsx("p",{className:"text-gray-500",children:"No hay gastos compartidos registrados."})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-8",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Gastos Compartidos"}),e.jsx("div",{className:"space-y-4",children:v.map(s=>{const t=y[s.id],o=s.email===u;return e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[s.nombre," ",o&&e.jsx("span",{children:"(soy yo)"})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Compartido con ",t?.otherPersonEmail]})]}),e.jsxs("button",{onClick:w,className:"bg-white p-3 rounded-lg shadow-sm hover:shadow-md transition-shadow cursor-pointer",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-indigo-600 font-medium",children:"Compartido"}),e.jsx("span",{className:"font-semibold text-gray-900",children:x(t?.total||0)})]}),e.jsxs("div",{className:"text-xs text-indigo-500",children:[t?.percentage||0,"% del total"]})]})]},s.id)})}),n.length>0&&e.jsx(P,{isOpen:h,onClose:()=>{d(!1),a([])},gastos:n,personas:r})]})},I=()=>e.jsx(C,{children:e.jsx(S,{})});export{I as default};
