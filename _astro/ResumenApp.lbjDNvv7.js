import{j as o}from"./jsx-runtime.D_zvdyIk.js";import{r as u}from"./index.DFATbet1.js";import{c as X,o as q,g as Y,P as z}from"./PieChart.DAgtbrRn.js";import{u as K,G as J}from"./GastosContext.ChU6grDc.js";import{u as Q}from"./useCurrency.CU1OSAUD.js";import{u as U}from"./useTheme.cFrPRT2G.js";import{m as H}from"./proxy.B2mgxuCV.js";import"./_commonjsHelpers.D6-XlEtG.js";import"./supabase.D8XsvUjI.js";import"./LoadingSpinner.CRtF3Vaf.js";const Z=()=>{const{gastos:g}=K(),{formatCurrency:F}=Q(),{isDarkMode:h}=U(),w=u.useRef(null),[l,k]=u.useState(null),[y,v]=u.useState(null),j=u.useRef(null),P=u.useRef(0),G=u.useMemo(()=>{const t=[...g];return l?.monto!==void 0&&l?.monto>0&&l?.mes&&t.push(l),X(t)},[g,l]),b=Object.entries(G).sort(([t],[s])=>{const e=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"];return e.indexOf(t)-e.indexOf(s)}),$=Object.values(G).reduce((t,s)=>t+s,0),R=(t,s,e)=>{const a=q(t);return Y(a,s,e)},I=t=>t>=1e6?`${(t/1e6).toFixed(1)}M`:t>=1e3?`${(t/1e3).toFixed(1)}K`:t.toString(),f=(t=1)=>{const s=w.current;if(!s)return;const e=s.getContext("2d");if(!e)return;const a=window.devicePixelRatio||1,n=470,i=300;s.width=n*a,s.height=i*a,e.scale(a,a),s.style.width=`${n}px`,s.style.height=`${i}px`,e.clearRect(0,0,n,i);const r={top:40,right:30,bottom:60,left:70},m=n-r.left-r.right,c=i-r.top-r.bottom,x=Math.max(...Object.values(G)),M=c/x;e.strokeStyle=h?"#374151":"#E5E7EB",e.lineWidth=1;const C=5;for(let d=0;d<=C;d++){const p=r.top+c*d/C,N=x-x*d/C;e.beginPath(),e.moveTo(r.left,p),e.lineTo(n-r.right,p),e.stroke(),e.fillStyle=h?"#9CA3AF":"#6B7280",e.font="12px Inter, system-ui, sans-serif",e.textAlign="right",e.textBaseline="middle",e.fillText(`$ ${I(N)}`,r.left-10,p)}const B=b.length,E=Math.min(40,(m-(B-1)*20)/B),V=20;b.forEach(([d,p],N)=>{const A=r.left+N*(E+V),L=p*M*t,O=r.top+c-L,T=R(d,N,B),S=y===d;S&&(e.shadowColor=T,e.shadowBlur=15,e.shadowOffsetX=0,e.shadowOffsetY=5),e.fillStyle=T,e.beginPath(),e.roundRect(A,O,E,L,[8,8,0,0]),e.fill(),e.shadowColor="transparent",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0,e.fillStyle=h?"#9CA3AF":"#6B7280",e.font="12px Inter, system-ui, sans-serif",e.textAlign="center",e.textBaseline="top",e.fillText(d,A+E/2,i-r.bottom+10),S&&(e.fillStyle=h?"#F3F4F6":"#1F2937",e.font="bold 12px Inter, system-ui, sans-serif",e.textAlign="center",e.textBaseline="bottom",e.fillText(F(p),A+E/2,O-5))})};u.useEffect(()=>{const t=g.length,s=t>P.current;if(P.current=t,!s){f(1);return}let e;const a=800,n=i=>{e||(e=i);const r=i-e,m=Math.min(r/a,1);f(m),m<1&&(j.current=requestAnimationFrame(n))};return j.current=requestAnimationFrame(n),()=>{j.current&&cancelAnimationFrame(j.current)}},[g,l,y,h]),u.useEffect(()=>{f(1);const t=()=>{k(null),f(1)},s=()=>{k(null),f(1)},e=a=>{k(a.detail),f(1)};return window.addEventListener("nuevoGasto",t),window.addEventListener("gastoEliminado",s),document.addEventListener("gastoPreview",e),()=>{window.removeEventListener("nuevoGasto",t),window.removeEventListener("gastoEliminado",s),document.removeEventListener("gastoPreview",e)}},[g,l,y,h]);const W=t=>{if(!w.current)return;const e=w.current.getBoundingClientRect(),a=t.clientX-e.left,n={left:70,right:30},i=b.length,r=Math.min(40,(470-n.left-n.right-(i-1)*20)/i),c=Math.floor((a-n.left)/(r+20)),x=b.map(([M])=>M);c>=0&&c<x.length?v(x[c]):v(null)},D=(t,s)=>t?"bg-indigo-50 dark:bg-indigo-900/20 border border-indigo-100 dark:border-indigo-800":s?"bg-gray-100 dark:bg-gray-700":"bg-gray-50 dark:bg-gray-800/50";return o.jsx(H.div,{className:"w-full h-full",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:o.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-4 sm:p-6 border border-gray-100 dark:border-gray-700",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white",children:"Gastos por Mes"}),l&&o.jsx("span",{className:"bg-indigo-100 dark:bg-indigo-900 text-indigo-800 dark:text-indigo-200 text-xs font-medium px-2.5 py-0.5 rounded-md",children:"Vista previa activa"})]}),o.jsx("div",{className:"relative w-[470px] h-[300px] mx-auto",children:o.jsx("canvas",{ref:w,className:"absolute inset-0 w-full h-full cursor-pointer",onMouseMove:W,onMouseLeave:()=>v(null)})}),o.jsx("div",{className:"mt-6 grid grid-cols-1 sm:grid-cols-2 gap-3",children:b.map(([t,s],e)=>{const a=(s/$*100).toFixed(1),n=g.filter(c=>c.mes===t),i=R(t,e,n.length),r=l&&l.mes===t,m=y===t;return o.jsxs(H.div,{className:`flex items-center justify-between p-3 rounded-lg transition-all ${D(r,m)}`,onMouseEnter:()=>v(t),onMouseLeave:()=>v(null),whileHover:{scale:1.02},whileTap:{scale:.98},children:[o.jsxs("div",{className:"flex items-center space-x-3 min-w-0",children:[o.jsx("div",{className:"w-4 h-4 rounded-full flex-shrink-0",style:{backgroundColor:i}}),o.jsx("span",{className:"font-medium text-gray-900 dark:text-white text-sm sm:text-base truncate",children:t})]}),o.jsxs("div",{className:"text-right ml-2",children:[o.jsx("div",{className:"font-medium text-gray-900 dark:text-white text-sm sm:text-base whitespace-nowrap",children:F(s)}),o.jsxs("div",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400 whitespace-nowrap",children:[a,"%"]})]})]},t)})})]})})},ce=()=>o.jsx(J,{children:o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[o.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[o.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Distribuci√≥n por Mes"}),o.jsx(z,{})]}),o.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:o.jsx(Z,{})})]})});export{ce as default};
