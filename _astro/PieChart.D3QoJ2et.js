import{j as n}from"./jsx-runtime.D_zvdyIk.js";import{r}from"./index.BVOCwoKb.js";import{u as U,a as Z}from"./useCurrency.B1lyyYv9.js";const _=u=>u.reduce((p,k)=>{const{mes:f,monto:F}=k;return p[f]||(p[f]=0),p[f]+=F,p},{}),ee={Enero:"#FF6384",Febrero:"#FF9F40",Marzo:"#FFCE56",Abril:"#4BC0C0",Mayo:"#36A2EB",Junio:"#9966FF",Julio:"#FF6384",Agosto:"#FF9F40",Septiembre:"#FFCE56",Octubre:"#4BC0C0",Noviembre:"#36A2EB",Diciembre:"#9966FF"},te=u=>ee[u]||"#C9CBCF",ae=()=>{const{gastos:u,personas:p}=U(),{formatCurrency:k}=Z(),f=r.useRef(null),F=r.useRef(null),[d,D]=r.useState("mes"),[x,H]=r.useState("todos"),[se,G]=r.useState(0),[M,w]=r.useState(null),[o,I]=r.useState(null),T=r.useRef(0),X=r.useCallback(t=>t.reduce((s,e)=>{if(e.escompartido)e.porcentajepersona1&&(s.persona1=(s.persona1||0)+e.monto*e.porcentajepersona1/100),e.porcentajepersona2&&(s.persona2=(s.persona2||0)+e.monto*e.porcentajepersona2/100);else{const a=e.personaid;s[a]=(s[a]||0)+e.monto}return s},{}),[]);r.useCallback(()=>{const t=[...u];return o&&o.monto&&o.monto>0&&o.mes&&o.personaid&&t.push(o),x==="todos"?t:t.filter(s=>s.personaid===x||s.escompartido&&(x==="persona1"&&s.porcentajepersona1||x==="persona2"&&s.porcentajepersona2))},[x,u,o]);const N=r.useCallback(()=>d==="mes"?_(u):X(u),[d,u,X]),Y=r.useCallback(t=>{const s=Object.values(t).reduce((e,a)=>e+a,0);return s===0?{}:Object.entries(t).reduce((e,[a,i])=>(e[a]=i/s*100,e),{})},[]),E=r.useCallback(()=>{const t=N();return Y(t)},[Y,N]),B=r.useCallback(t=>{const s=p.find(e=>e.id===t);return s?s.nombre:t},[p]);r.useCallback(t=>{switch(t){case"persona1":return"#4F46E5";case"persona2":return"#EC4899";default:return"#9CA3AF"}},[]);const O=t=>d==="mes"?te(t):"#6B7280",P=r.useCallback((t=1)=>{if(!f.current)return;const s=f.current,e=s.getContext("2d");if(!e)return;const a=window.devicePixelRatio||1,i=s.getBoundingClientRect();s.width=i.width*a,s.height=i.height*a,e.scale(a,a),s.style.width=`${i.width}px`,s.style.height=`${i.height}px`,e.clearRect(0,0,i.width,i.height);const c=i.width/2,l=i.height/2,m=Math.min(c,l)-20,C=E();if(Object.keys(C).length===0){e.fillStyle="#F3F4F6",e.beginPath(),e.arc(c,l,m,0,Math.PI*2),e.fill(),e.fillStyle="#9CA3AF",e.font="bold 16px Inter, system-ui, sans-serif",e.textAlign="center",e.textBaseline="middle",e.fillText("No hay datos",c,l);return}e.save(),e.shadowColor="rgba(0, 0, 0, 0.1)",e.shadowBlur=10,e.shadowOffsetX=0,e.shadowOffsetY=4,e.beginPath(),e.arc(c,l,m,0,Math.PI*2),e.fill(),e.restore();let g=0;if(M){const h=s.getBoundingClientRect();h.width/2,h.height/2}Object.entries(C).forEach(([h,b])=>{const L=b*t,v=g+L/100*(Math.PI*2),y=g+(v-g)/2,A=M===h;let j=A?15:0;o&&o.monto&&o.monto>0&&(d==="mes"&&o.mes===h||d==="persona"&&o.personaid===h)&&(j=Math.max(j,10));const S=j*Math.cos(y),R=j*Math.sin(y);if(e.fillStyle=O(h),e.beginPath(),e.moveTo(c+S,l+R),e.arc(c+S,l+R,m,g,v),e.lineTo(c+S,l+R),e.closePath(),e.fill(),e.strokeStyle="#FFFFFF",e.lineWidth=2,e.stroke(),A&&t===1){const $=m*.7,V=c+S+$*Math.cos(y),q=l+R+$*Math.sin(y);e.fillStyle="rgba(255, 255, 255, 0.9)",e.beginPath(),e.roundRect(V-60,q-15,120,30,8),e.fill(),e.fillStyle="#111827",e.font="bold 14px Inter, system-ui, sans-serif",e.textAlign="center",e.textBaseline="middle",e.fillText(`${d==="mes"?h:B(h)}: ${b.toFixed(1)}%`,V,q)}g=v})},[E,M,O,d,B,o]),J=r.useCallback(t=>{if(!f.current)return;const e=f.current.getBoundingClientRect(),a=t.clientX-e.left,i=t.clientY-e.top,c=e.width/2,l=e.height/2,m=Math.min(c,l)-20,C=a-c,g=i-l;if(Math.sqrt(C*C+g*g)>m){w(null);return}let b=Math.atan2(g,C);b<0&&(b+=2*Math.PI);const L=E();let v=0;for(const[y,A]of Object.entries(L)){const j=v+A/100*(Math.PI*2);if(b>=v&&b<j){w(y);return}v=j}w(null)},[E]);r.useEffect(()=>{const t=u.length,s=t>T.current;if(T.current=t,!s){P(1);return}G(0);let e;const a=800,i=c=>{e||(e=c);const l=c-e,m=Math.min(l/a,1);G(m),P(m),m<1&&(F.current=requestAnimationFrame(i))};return F.current=requestAnimationFrame(i),()=>{F.current&&cancelAnimationFrame(F.current)}},[u,d,x,P]),r.useEffect(()=>{o&&P(1)},[o,P]),r.useEffect(()=>{const t=()=>{G(0),I(null)};return document.addEventListener("nuevoGasto",t),()=>{document.removeEventListener("nuevoGasto",t)}},[]),r.useEffect(()=>{const t=s=>{I(s.detail)};return document.addEventListener("gastoPreview",t),()=>{document.removeEventListener("gastoPreview",t)}},[]);const z=Object.entries(N()).sort(([,t],[,s])=>s-t),W=Object.values(N()).reduce((t,s)=>t+s,0),K=()=>o&&o.monto&&o.monto>0?n.jsx("span",{className:"absolute top-0 right-0 bg-indigo-100 text-indigo-800 text-xs font-medium px-2.5 py-0.5 rounded-md",children:"Vista previa activa"}):null,Q=t=>({backgroundColor:O(t)});return n.jsxs("div",{className:"w-full h-full",children:[n.jsxs("div",{className:"mb-6 flex flex-wrap gap-4",children:[n.jsxs("div",{className:"flex items-center space-x-2 bg-white p-2 rounded-lg shadow-sm border border-gray-100 transition-all hover:shadow-md",children:[n.jsx("span",{className:"text-gray-600",children:"Ver por:"}),n.jsxs("select",{value:d,onChange:t=>D(t.target.value),className:"p-2 border rounded-md bg-gray-50 focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500 outline-none transition-all",children:[n.jsx("option",{value:"mes",children:"Mes"}),n.jsx("option",{value:"persona",children:"Persona"})]})]}),n.jsxs("div",{className:"flex items-center space-x-2 bg-white p-2 rounded-lg shadow-sm border border-gray-100 transition-all hover:shadow-md",children:[n.jsx("span",{className:"text-gray-600",children:"Filtrar:"}),n.jsxs("select",{value:x,onChange:t=>H(t.target.value),className:"p-2 border rounded-md bg-gray-50 focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500 outline-none transition-all",children:[n.jsx("option",{value:"todos",children:"Todos"}),p.map(t=>n.jsx("option",{value:t.id,children:t.nombre},t.id))]})]})]}),n.jsxs("div",{className:"relative bg-white rounded-xl shadow-md p-6 border border-gray-100 transition-all hover:shadow-lg",children:[n.jsx(K,{}),n.jsx("canvas",{ref:f,width:300,height:300,className:"mx-auto cursor-pointer",onMouseMove:J,onMouseLeave:()=>w(null)}),n.jsx("div",{className:"mt-6 grid grid-cols-1 sm:grid-cols-2 gap-3",children:z.map(([t,s])=>{const e=o&&(d==="mes"&&o.mes===t||d==="persona"&&o.personaid===t);return n.jsxs("div",{className:`flex items-center p-3 rounded-lg transition-all ${M===t?"bg-gray-100 scale-105":e?"bg-indigo-50 border border-indigo-100":"hover:bg-gray-50"}`,onMouseEnter:()=>w(t),onMouseLeave:()=>w(null),children:[n.jsx("span",{className:"w-5 h-5 rounded-md inline-block mr-3 shadow-sm",style:Q(t)}),n.jsxs("div",{className:"flex-1",children:[n.jsx("span",{className:"font-medium text-gray-800",children:d==="mes"?t:B(t)}),n.jsxs("div",{className:"flex justify-between mt-1",children:[n.jsx("span",{className:"text-sm text-gray-600",children:k(s)}),n.jsxs("span",{className:"text-sm font-semibold text-indigo-600",children:[(s/W*100).toFixed(1),"%"]})]})]})]},t)})})]})]})};export{ae as P,_ as c,te as o};
