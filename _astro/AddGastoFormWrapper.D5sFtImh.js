import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as t}from"./index.DFATbet1.js";import{u as O,G as J}from"./GastosContext.ChU6grDc.js";import U from"./LoadingSpinner.CRtF3Vaf.js";import{s as A}from"./supabase.D8XsvUjI.js";import"./_commonjsHelpers.D6-XlEtG.js";const W=({value:u,onChange:h,className:l=""})=>{const{personas:x,isLoading:r}=O(),[m,p]=t.useState(!1);if(r)return e.jsx("div",{className:`animate-pulse bg-gray-200 rounded-md h-10 ${l}`});const c=x.find(i=>i.id===u);return e.jsxs("div",{className:`relative ${l}`,children:[e.jsxs("button",{type:"button",onClick:()=>p(!m),className:`w-full flex items-center justify-between p-2 border rounded-md bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500 transition-all ${m?"ring-2 ring-indigo-200 border-indigo-500":""}`,"aria-haspopup":"true","aria-expanded":m,children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-gray-700",children:c?c.nombre:"Seleccionar persona"}),c&&e.jsxs("span",{className:"text-sm text-gray-500",children:["(",c.email,")"]})]}),e.jsx("svg",{className:`h-5 w-5 text-gray-400 transition-transform ${m?"transform rotate-180":""}`,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),m&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-white shadow-lg rounded-md py-1",children:x.map(i=>e.jsx("button",{onClick:()=>{h(i.id),p(!1)},className:`w-full text-left px-4 py-2 text-sm ${i.id===u?"bg-indigo-50 text-indigo-700 font-medium":"text-gray-700 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:i.nombre}),e.jsx("span",{className:"text-sm text-gray-500",children:i.email})]})},i.id))})]})},P=u=>/.+@.+\..+/.test(u),T=()=>{const{agregarGasto:u,isLoading:h,personas:l,gastos:x}=O(),[r,m]=t.useState(!1),[p,c]=t.useState(50),[i,v]=t.useState(50),[f,y]=t.useState(""),[n,$]=t.useState(""),[b,M]=t.useState(""),[j,S]=t.useState(""),[g,R]=t.useState(()=>{const o=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],s=new Date().getMonth();return o[s]}),E=t.useRef(null),[F,_]=t.useState(""),[N,I]=t.useState(""),[G,C]=t.useState("");t.useEffect(()=>{if(l&&l.length>0){const o=l.find(s=>s.nombre==="Persona 1");o&&y(o.id)}},[l]),t.useEffect(()=>{l&&l.length>0&&A.auth.getUser().then(({data:{user:o}})=>{if(o){const s=l.find(a=>a.email===o.email);s&&y(s.id)}})},[l]),t.useEffect(()=>{A.auth.getUser().then(({data:{user:o}})=>{const s=o?.email??"Tu usuario";_(s),I(localStorage.getItem(`sueldo_${s}`)??"")})},[]);const z=()=>{if(!g)return"Nombre de gasto";const o=x.filter(a=>a.mes===g);let s=0;return o.forEach(a=>{const w=/\((\d+)\)$/.exec(a.descripcion);if(w){const D=parseInt(w[1]);D>s&&(s=D)}}),"Nombre de gasto"+(s>0?" ("+(s+1)+")":"")};t.useEffect(()=>{S(z())},[g,x]);const q=o=>{const s=o.target.value;(s===""||/^\d*\.?\d*$/.test(s))&&M(s)},L=()=>{if(!f||!b||!j||!g)return;const o={mes:g,descripcion:j,monto:parseFloat(b),personaid:f,escompartido:r,porcentajepersona1:r?p:100,porcentajepersona2:r?i:0,otraPersonaEmail:r?n:void 0};document.dispatchEvent(new CustomEvent("gastoPreview",{detail:o}))};t.useEffect(()=>{L()},[b,j,g,f,r,p,i,n]),t.useEffect(()=>{if(P(n)){if(C(localStorage.getItem(`sueldo_${n}`)??""),N){const{porcentaje1:o,porcentaje2:s}=k(parseFloat(N)||0,parseFloat(localStorage.getItem(`sueldo_${n}`)??"0"));c(o),v(s)}}else C("")},[n]);const k=(o,s)=>{if(o===0&&s===0)return{porcentaje1:50,porcentaje2:50};const a=o+s,d=Math.round(o/a*100),w=100-d;return{porcentaje1:d,porcentaje2:w}},V=o=>{const s=o.target.value;if((s===""||/^\d*\.?\d*$/.test(s))&&(I(s),localStorage.setItem(`sueldo_${F}`,s),P(n))){const{porcentaje1:a,porcentaje2:d}=k(parseFloat(s)||0,parseFloat(G)||0);c(a),v(d)}},B=o=>{const s=o.target.value;if((s===""||/^\d*\.?\d*$/.test(s))&&(C(s),P(n))){localStorage.setItem(`sueldo_${n}`,s);const{porcentaje1:a,porcentaje2:d}=k(parseFloat(N)||0,parseFloat(s)||0);c(a),v(d)}};if(h)return e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6 mb-8",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(U,{size:"large",color:"primary"})})});const H=async o=>{if(o.preventDefault(),!f){alert("Por favor selecciona una persona");return}if(r&&!n){alert("Por favor ingresa el email de la otra persona");return}const s=parseFloat(b);if(isNaN(s)){alert("Por favor ingresa un monto válido");return}if(s>9999999999e-2){alert("El monto no puede exceder $99,999,999.99");return}const a={mes:g,descripcion:j,monto:s,personaid:f,escompartido:r,porcentajepersona1:r?p:100,porcentajepersona2:r?i:0,otraPersonaEmail:r?n:void 0};try{await u(a),M(""),S(z()),y(""),m(!1),c(50),v(50),$(""),E.current&&E.current.reset()}catch(d){console.error("Error al agregar gasto:",d),alert("Hubo un error al agregar el gasto. Por favor intenta nuevamente.")}};return e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6 mb-8",children:e.jsxs("form",{ref:E,onSubmit:H,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"monto",className:"block text-sm font-medium text-gray-700 mb-1",children:"Monto"}),e.jsx("input",{type:"number",id:"monto",name:"monto",required:!0,value:b,onChange:q,className:"w-full p-2 border rounded-md focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500 outline-none transition-all",placeholder:""})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"descripcion",className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripción"}),e.jsx("input",{type:"text",id:"descripcion",name:"descripcion",required:!0,value:j,onChange:o=>S(o.target.value),className:"w-full p-2 border rounded-md focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500 outline-none transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mes",className:"block text-sm font-medium text-gray-700 mb-1",children:"Mes"}),e.jsxs("select",{id:"mes",name:"mes",required:!0,value:g,onChange:o=>R(o.target.value),className:"w-full p-2 border rounded-md focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500 outline-none transition-all",children:[e.jsx("option",{value:"enero",children:"Enero"}),e.jsx("option",{value:"febrero",children:"Febrero"}),e.jsx("option",{value:"marzo",children:"Marzo"}),e.jsx("option",{value:"abril",children:"Abril"}),e.jsx("option",{value:"mayo",children:"Mayo"}),e.jsx("option",{value:"junio",children:"Junio"}),e.jsx("option",{value:"julio",children:"Julio"}),e.jsx("option",{value:"agosto",children:"Agosto"}),e.jsx("option",{value:"septiembre",children:"Septiembre"}),e.jsx("option",{value:"octubre",children:"Octubre"}),e.jsx("option",{value:"noviembre",children:"Noviembre"}),e.jsx("option",{value:"diciembre",children:"Diciembre"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"persona",className:"block text-sm font-medium text-gray-700 mb-1",children:"Persona"}),e.jsx(W,{value:f,onChange:o=>y(o),className:"w-full"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"shared",name:"shared",checked:r,onChange:o=>m(o.target.checked),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"shared",className:"text-sm text-gray-700",children:"Gasto compartido"})]}),r&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"otraPersonaEmail",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email de la otra persona"}),e.jsx("input",{type:"email",id:"otraPersonaEmail",name:"otraPersonaEmail",value:n,onChange:o=>$(o.target.value),required:r,className:"w-full p-2 border rounded-md focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500 outline-none transition-all",placeholder:"ejemplo@email.com"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"sueldoPersona1",className:"block text-sm font-medium text-gray-700 mb-1",children:["Sueldo ",F]}),e.jsx("input",{type:"number",id:"sueldoPersona1",name:"sueldoPersona1",value:N,onChange:V,className:"w-full p-2 border rounded-md focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500 outline-none transition-all",placeholder:"Ingresa el sueldo"})]}),P(n)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"sueldoPersona2",className:"block text-sm font-medium text-gray-700 mb-1",children:["Sueldo ",n]}),e.jsx("input",{type:"number",id:"sueldoPersona2",name:"sueldoPersona2",value:G,onChange:B,className:"w-full p-2 border rounded-md focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500 outline-none transition-all",placeholder:"Ingresa el sueldo"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"percentage1",className:"block text-sm font-medium text-gray-700 mb-1",children:["Porcentaje ",F]}),e.jsx("input",{type:"number",id:"percentage1",name:"percentage1",min:"0",max:"100",value:p,readOnly:!0,className:"w-full p-2 border rounded-md bg-gray-50 focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500 outline-none transition-all"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"percentage2",className:"block text-sm font-medium text-gray-700 mb-1",children:["Porcentaje ",n]}),e.jsx("input",{type:"number",id:"percentage2",name:"percentage2",min:"0",max:"100",value:i,readOnly:!0,className:"w-full p-2 border rounded-md bg-gray-50 focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500 outline-none transition-all"})]})]})]}),e.jsx("button",{type:"submit",className:"w-full bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-colors",children:"Agregar Gasto"})]})})},se=()=>{const[u,h]=t.useState(!1);return t.useEffect(()=>{h(!0)},[]),u?e.jsx(J,{children:e.jsx(T,{})}):e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6 mb-8",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"inline-block animate-spin w-12 h-12 text-indigo-600",children:e.jsxs("svg",{className:"w-full h-full",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})})})})};export{se as AddGastoFormWrapper};
