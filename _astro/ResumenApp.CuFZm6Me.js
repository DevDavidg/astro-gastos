import{j as s}from"./jsx-runtime.D_zvdyIk.js";import{r as d}from"./index.BVOCwoKb.js";import{c as X,o as Y,g as q,P as z}from"./PieChart.DnnVCn_b.js";import{u as K,G as J}from"./GastosContext.BTDxljjR.js";import{u as Q}from"./useCurrency.D8rWf9GG.js";import{u as U}from"./useTheme.CDq_IHLp.js";import{m as $}from"./proxy.dwpEO49j.js";import"./supabase.4P1wv7wr.js";import"./LoadingSpinner.D7PxHcXC.js";const Z=()=>{const{gastos:g}=K(),{formatCurrency:F}=Q(),{isDarkMode:h}=U(),w=d.useRef(null),[l,G]=d.useState(null),[y,b]=d.useState(null),[_,P]=d.useState(!1),j=d.useRef(null),R=d.useRef(0),M=d.useMemo(()=>{const t=[...g];return l&&l.monto&&l.monto>0&&l.mes&&t.push(l),X(t)},[g,l]),v=Object.entries(M).sort(([t],[o])=>{const e=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"];return e.indexOf(t)-e.indexOf(o)}),I=Object.values(M).reduce((t,o)=>t+o,0),L=(t,o,e)=>{const r=Y(t);return q(r,o,e)},W=t=>t>=1e6?`${(t/1e6).toFixed(1)}M`:t>=1e3?`${(t/1e3).toFixed(1)}K`:t.toString(),f=(t=1)=>{const o=w.current;if(!o)return;const e=o.getContext("2d");if(!e)return;const r=window.devicePixelRatio||1,a=470,i=300;o.width=a*r,o.height=i*r,e.scale(r,r),o.style.width=`${a}px`,o.style.height=`${i}px`,e.clearRect(0,0,a,i);const n={top:40,right:30,bottom:60,left:70},m=a-n.left-n.right,c=i-n.top-n.bottom,x=Math.max(...Object.values(M)),k=c/x;e.strokeStyle=h?"#374151":"#E5E7EB",e.lineWidth=1;const C=5;for(let u=0;u<=C;u++){const p=n.top+c*u/C,N=x-x*u/C;e.beginPath(),e.moveTo(n.left,p),e.lineTo(a-n.right,p),e.stroke(),e.fillStyle=h?"#9CA3AF":"#6B7280",e.font="12px Inter, system-ui, sans-serif",e.textAlign="right",e.textBaseline="middle",e.fillText(`$ ${W(N)}`,n.left-10,p)}const A=v.length,E=Math.min(40,(m-(A-1)*20)/A),V=20;v.forEach(([u,p],N)=>{const B=n.left+N*(E+V),O=p*k*t,T=n.top+c-O,S=L(u,N,A),H=y===u;H&&(e.shadowColor=S,e.shadowBlur=15,e.shadowOffsetX=0,e.shadowOffsetY=5),e.fillStyle=S,e.beginPath(),e.roundRect(B,T,E,O,[8,8,0,0]),e.fill(),e.shadowColor="transparent",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0,e.fillStyle=h?"#9CA3AF":"#6B7280",e.font="12px Inter, system-ui, sans-serif",e.textAlign="center",e.textBaseline="top",e.fillText(u,B+E/2,i-n.bottom+10),H&&(e.fillStyle=h?"#F3F4F6":"#1F2937",e.font="bold 12px Inter, system-ui, sans-serif",e.textAlign="center",e.textBaseline="bottom",e.fillText(F(p),B+E/2,T-5))})};d.useEffect(()=>{const t=g.length,o=t>R.current;if(R.current=t,!o){f(1);return}P(!0);let e;const r=800,a=i=>{e||(e=i);const n=i-e,m=Math.min(n/r,1);f(m),m<1?j.current=requestAnimationFrame(a):P(!1)};return j.current=requestAnimationFrame(a),()=>{j.current&&cancelAnimationFrame(j.current)}},[g,l,y,h]),d.useEffect(()=>{f(1);const t=()=>{G(null),f(1)},o=r=>{G(null),f(1)},e=r=>{G(r.detail),f(1)};return window.addEventListener("nuevoGasto",t),window.addEventListener("gastoEliminado",o),document.addEventListener("gastoPreview",e),()=>{window.removeEventListener("nuevoGasto",t),window.removeEventListener("gastoEliminado",o),document.removeEventListener("gastoPreview",e)}},[g,l,y,h]);const D=t=>{if(!w.current)return;const e=w.current.getBoundingClientRect(),r=t.clientX-e.left;t.clientY-e.top;const a={left:70,right:30},i=v.length,n=Math.min(40,(470-a.left-a.right-(i-1)*20)/i),c=Math.floor((r-a.left)/(n+20)),x=v.map(([k])=>k);c>=0&&c<x.length?b(x[c]):b(null)};return s.jsx($.div,{className:"w-full h-full",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-4 sm:p-6 border border-gray-100 dark:border-gray-700",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white",children:"Gastos por Mes"}),l&&s.jsx("span",{className:"bg-indigo-100 dark:bg-indigo-900 text-indigo-800 dark:text-indigo-200 text-xs font-medium px-2.5 py-0.5 rounded-md",children:"Vista previa activa"})]}),s.jsx("div",{className:"relative w-[470px] h-[300px] mx-auto",children:s.jsx("canvas",{ref:w,className:"absolute inset-0 w-full h-full cursor-pointer",onMouseMove:D,onMouseLeave:()=>b(null)})}),s.jsx("div",{className:"mt-6 grid grid-cols-1 sm:grid-cols-2 gap-3",children:v.map(([t,o],e)=>{const r=(o/I*100).toFixed(1),a=g.filter(c=>c.mes===t),i=L(t,e,a.length),n=l&&l.mes===t,m=y===t;return s.jsxs($.div,{className:`flex items-center justify-between p-3 rounded-lg transition-all ${n?"bg-indigo-50 dark:bg-indigo-900/20 border border-indigo-100 dark:border-indigo-800":m?"bg-gray-100 dark:bg-gray-700":"bg-gray-50 dark:bg-gray-800/50"}`,onMouseEnter:()=>b(t),onMouseLeave:()=>b(null),whileHover:{scale:1.02},whileTap:{scale:.98},children:[s.jsxs("div",{className:"flex items-center space-x-3 min-w-0",children:[s.jsx("div",{className:"w-4 h-4 rounded-full flex-shrink-0",style:{backgroundColor:i}}),s.jsx("span",{className:"font-medium text-gray-900 dark:text-white text-sm sm:text-base truncate",children:t})]}),s.jsxs("div",{className:"text-right ml-2",children:[s.jsx("div",{className:"font-medium text-gray-900 dark:text-white text-sm sm:text-base whitespace-nowrap",children:F(o)}),s.jsxs("div",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400 whitespace-nowrap",children:[r,"%"]})]})]},t)})})]})})},ce=()=>s.jsx(J,{children:s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[s.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[s.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Distribuci√≥n por Mes"}),s.jsx(z,{})]}),s.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:s.jsx(Z,{})})]})});export{ce as default};
