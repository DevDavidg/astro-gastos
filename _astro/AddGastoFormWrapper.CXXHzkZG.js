import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as o}from"./index.BVOCwoKb.js";import{u as M,G as I}from"./GastosContext.FOfI830u.js";import R from"./LoadingSpinner.D7PxHcXC.js";import{s as q}from"./supabase.4P1wv7wr.js";const L=({value:u,onChange:p,className:c=""})=>{const{personas:x,isLoading:r}=M(),[a,d]=o.useState(!1);if(r)return e.jsx("div",{className:`animate-pulse bg-gray-200 rounded-md h-10 ${c}`});const i=x.find(n=>n.id===u);return e.jsxs("div",{className:`relative ${c}`,children:[e.jsxs("button",{type:"button",onClick:()=>d(!a),className:`w-full flex items-center justify-between p-2 border rounded-md bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500 transition-all ${a?"ring-2 ring-indigo-200 border-indigo-500":""}`,"aria-haspopup":"true","aria-expanded":a,children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-gray-700",children:i?i.nombre:"Seleccionar persona"}),i&&e.jsxs("span",{className:"text-sm text-gray-500",children:["(",i.email,")"]})]}),e.jsx("svg",{className:`h-5 w-5 text-gray-400 transition-transform ${a?"transform rotate-180":""}`,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),a&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-white shadow-lg rounded-md py-1",children:x.map(n=>e.jsx("button",{onClick:()=>{p(n.id),d(!1)},className:`w-full text-left px-4 py-2 text-sm ${n.id===u?"bg-indigo-50 text-indigo-700 font-medium":"text-gray-700 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:n.nombre}),e.jsx("span",{className:"text-sm text-gray-500",children:n.email})]})},n.id))})]})},O=()=>{const{agregarGasto:u,isLoading:p,personas:c,gastos:x}=M(),[r,a]=o.useState(!1),[d,i]=o.useState(50),[n,j]=o.useState(50),[g,v]=o.useState(""),[h,y]=o.useState(""),[f,P]=o.useState(""),[b,N]=o.useState(""),[l,E]=o.useState("enero"),w=o.useRef(null);o.useEffect(()=>{c&&c.length>0&&q.auth.getUser().then(({data:{user:s}})=>{if(s){const t=c.find(m=>m.email===s.email);t&&v(t.id)}})},[c]);const C=()=>{if(!l)return"Nombre de gasto";const s=x.filter(m=>m.mes===l);let t=0;return s.forEach(m=>{const k=/\((\d+)\)$/.exec(m.descripcion);if(k){const F=parseInt(k[1]);F>t&&(t=F)}}),"Nombre de gasto"+(t>0?" ("+(t+1)+")":"")};o.useEffect(()=>{N(C())},[l,x]);const G=s=>{i(s),j(100-s)},$=s=>{j(s),i(100-s)},z=s=>{const t=s.target.value;(t===""||/^\d*\.?\d*$/.test(t))&&P(t)},D=()=>{if(!g||!f||!b||!l)return;const s={mes:l,descripcion:b,monto:parseFloat(f),personaid:g,escompartido:r,porcentajepersona1:r?d:100,porcentajepersona2:r?n:0,otraPersonaEmail:r?h:void 0};document.dispatchEvent(new CustomEvent("gastoPreview",{detail:s}))};if(o.useEffect(()=>{D()},[f,b,l,g,r,d,n,h]),p)return e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6 mb-8",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(R,{size:"large",color:"primary"})})});const A=async s=>{if(s.preventDefault(),!g){alert("Por favor selecciona una persona");return}if(r&&!h){alert("Por favor ingresa el email de la otra persona");return}const t=parseFloat(f);if(isNaN(t)){alert("Por favor ingresa un monto válido");return}if(t>9999999999e-2){alert("El monto no puede exceder $99,999,999.99");return}const m={mes:l,descripcion:b,monto:t,personaid:g,escompartido:r,porcentajepersona1:r?d:100,porcentajepersona2:r?n:0,otraPersonaEmail:r?h:void 0};try{await u(m),w.current&&w.current.reset(),v(""),a(!1),i(50),j(50),y(""),P(""),N(C()),E("enero"),window.location.reload()}catch(S){console.error("Error al agregar gasto:",S)}};return e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6 mb-8",children:e.jsxs("form",{ref:w,onSubmit:A,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"monto",className:"block text-sm font-medium text-gray-700 mb-1",children:"Monto"}),e.jsx("input",{type:"text",id:"monto",name:"monto",required:!0,value:f,onChange:z,className:"w-full p-2 border rounded-md focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500 outline-none transition-all",placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"descripcion",className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripción"}),e.jsx("input",{type:"text",id:"descripcion",name:"descripcion",required:!0,value:b,onChange:s=>N(s.target.value),className:"w-full p-2 border rounded-md focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500 outline-none transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mes",className:"block text-sm font-medium text-gray-700 mb-1",children:"Mes"}),e.jsxs("select",{id:"mes",name:"mes",required:!0,value:l,onChange:s=>E(s.target.value),className:"w-full p-2 border rounded-md focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500 outline-none transition-all",children:[e.jsx("option",{value:"enero",children:"Enero"}),e.jsx("option",{value:"febrero",children:"Febrero"}),e.jsx("option",{value:"marzo",children:"Marzo"}),e.jsx("option",{value:"abril",children:"Abril"}),e.jsx("option",{value:"mayo",children:"Mayo"}),e.jsx("option",{value:"junio",children:"Junio"}),e.jsx("option",{value:"julio",children:"Julio"}),e.jsx("option",{value:"agosto",children:"Agosto"}),e.jsx("option",{value:"septiembre",children:"Septiembre"}),e.jsx("option",{value:"octubre",children:"Octubre"}),e.jsx("option",{value:"noviembre",children:"Noviembre"}),e.jsx("option",{value:"diciembre",children:"Diciembre"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"persona",className:"block text-sm font-medium text-gray-700 mb-1",children:"Persona"}),e.jsx(L,{value:g,onChange:s=>v(s),className:"w-full"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"shared",name:"shared",checked:r,onChange:s=>a(s.target.checked),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"shared",className:"text-sm text-gray-700",children:"Gasto compartido"})]}),r&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"otraPersonaEmail",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email de la otra persona"}),e.jsx("input",{type:"email",id:"otraPersonaEmail",name:"otraPersonaEmail",value:h,onChange:s=>y(s.target.value),required:r,className:"w-full p-2 border rounded-md focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500 outline-none transition-all",placeholder:"ejemplo@email.com"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"percentage1",className:"block text-sm font-medium text-gray-700 mb-1",children:"Porcentaje Persona 1"}),e.jsx("input",{type:"number",id:"percentage1",name:"percentage1",min:"0",max:"100",value:d,onChange:s=>G(parseInt(s.target.value)),className:"w-full p-2 border rounded-md focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500 outline-none transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"percentage2",className:"block text-sm font-medium text-gray-700 mb-1",children:"Porcentaje Persona 2"}),e.jsx("input",{type:"number",id:"percentage2",name:"percentage2",min:"0",max:"100",value:n,onChange:s=>$(parseInt(s.target.value)),className:"w-full p-2 border rounded-md focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500 outline-none transition-all"})]})]}),e.jsx("button",{type:"submit",className:"w-full bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-colors",children:"Agregar Gasto"})]})})},U=()=>{const[u,p]=o.useState(!1);return o.useEffect(()=>{p(!0)},[]),u?e.jsx(I,{children:e.jsx(O,{})}):e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6 mb-8",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"inline-block animate-spin w-12 h-12 text-indigo-600",children:e.jsxs("svg",{className:"w-full h-full",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})})})})};export{U as AddGastoFormWrapper};
